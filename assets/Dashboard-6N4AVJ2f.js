import{a as p,I as D,h as L,ah as e,ar as P,as as $,ap as O}from"./index-CIj5hYV2.js";import{d as C}from"./dayjs.min-Dklab4Fo.js";import{I as E,J as Y,F as b,M as _,O as N,Q as m,V as k,W as x,T as V,X as U}from"./IdurarOs-WAmMcj9g.js";import{u as I}from"./useMoney-DiKHe5ew.js";import{D as H,E as W}from"./ErpApp-C-2FDLT4.js";import{u as z}from"./useFetch-BR6tjQO5.js";import{e as T}from"./actions-CYbjwKLg.js";import{F as K}from"./Table-DV_aFHIC.js";import{T as B}from"./index-DzlEGkBV.js";import{P as M}from"./progress-5w2SBPjO.js";import{S as Q}from"./index-ejP9R5AC.js";import"./addEventListener-BttWova1.js";import"./index-DwiXKtux.js";import"./Pagination-DB3V0wCi.js";import"./Skeleton-CjmdXO-j.js";var R={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M862 465.3h-81c-4.6 0-9 2-12.1 5.5L550 723.1V160c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v563.1L255.1 470.8c-3-3.5-7.4-5.5-12.1-5.5h-81c-6.8 0-10.5 8.1-6 13.2L487.9 861a31.96 31.96 0 0048.3 0L868 478.5c4.5-5.2.8-13.2-6-13.2z"}}]},name:"arrow-down",theme:"outlined"},q=function(n,r){return p.createElement(D,L({},n,{ref:r,icon:R}))};const J=p.forwardRef(q);var X={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M868 545.5L536.1 163a31.96 31.96 0 00-48.3 0L156 545.5a7.97 7.97 0 006 13.2h81c4.6 0 9-2 12.1-5.5L474 300.9V864c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V300.9l218.9 252.3c3 3.5 7.4 5.5 12.1 5.5h81c6.8 0 10.5-8 6-13.2z"}}]},name:"arrow-up",theme:"outlined"},G=function(n,r){return p.createElement(D,L({},n,{ref:r,icon:X}))};const Z=p.forwardRef(G);var ee={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M531.3 574.4l.3-1.4c5.8-23.9 13.1-53.7 7.4-80.7-3.8-21.3-19.5-29.6-32.9-30.2-15.8-.7-29.9 8.3-33.4 21.4-6.6 24-.7 56.8 10.1 98.6-13.6 32.4-35.3 79.5-51.2 107.5-29.6 15.3-69.3 38.9-75.2 68.7-1.2 5.5.2 12.5 3.5 18.8 3.7 7 9.6 12.4 16.5 15 3 1.1 6.6 2 10.8 2 17.6 0 46.1-14.2 84.1-79.4 5.8-1.9 11.8-3.9 17.6-5.9 27.2-9.2 55.4-18.8 80.9-23.1 28.2 15.1 60.3 24.8 82.1 24.8 21.6 0 30.1-12.8 33.3-20.5 5.6-13.5 2.9-30.5-6.2-39.6-13.2-13-45.3-16.4-95.3-10.2-24.6-15-40.7-35.4-52.4-65.8zM421.6 726.3c-13.9 20.2-24.4 30.3-30.1 34.7 6.7-12.3 19.8-25.3 30.1-34.7zm87.6-235.5c5.2 8.9 4.5 35.8.5 49.4-4.9-19.9-5.6-48.1-2.7-51.4.8.1 1.5.7 2.2 2zm-1.6 120.5c10.7 18.5 24.2 34.4 39.1 46.2-21.6 4.9-41.3 13-58.9 20.2-4.2 1.7-8.3 3.4-12.3 5 13.3-24.1 24.4-51.4 32.1-71.4zm155.6 65.5c.1.2.2.5-.4.9h-.2l-.2.3c-.8.5-9 5.3-44.3-8.6 40.6-1.9 45 7.3 45.1 7.4zm191.4-388.2L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494z"}}]},name:"file-pdf",theme:"outlined"},te=function(n,r){return p.createElement(D,L({},n,{ref:r,icon:ee}))};const ne=p.forwardRef(te);function ae({...t}){const n=b();let{entity:r,dataTableColumns:a}=t;const o=[{label:n("Chi tiết"),key:"read",icon:e.jsx(E,{})},{label:n("Chỉnh sửa"),key:"edit",icon:e.jsx(Y,{})},{label:n("PDF"),key:"download",icon:e.jsx(ne,{})}],g=P(),s=$(),h=l=>{s(T.currentItem({data:l})),g(`/${r}/read/${l.id}`)},d=l=>{s(T.currentAction({actionType:"update",data:l})),g(`/${r}/update/${l.id}`)},v=l=>{window.open(`${_}${r}/${r}-${l.id}.pdf`,"_blank")};a=[...a,{title:"",key:"action",render:(l,j)=>e.jsx(H,{menu:{items:o,onClick:({key:w})=>{switch(w){case"read":h(j);break;case"edit":d(j);break;case"download":v(j);break}}},trigger:["click"],children:e.jsx(W,{style:{cursor:"pointer",fontSize:"24px"},onClick:w=>w.preventDefault()})})}];const f=()=>N.list({entity:r}),{result:i,isLoading:c,isSuccess:u}=z(f),y=()=>u&&i?i.pageItems.slice(0,5):[];return e.jsx(K,{columns:a,rowKey:l=>l.id,dataSource:u&&y(),pagination:!1,loading:c,scroll:{x:!0}})}function S({title:t,tagColor:n,data:r,prefix:a,isCurrency:o=!0,isLoading:g=!1}){const{formatCurrency:s}=I();return e.jsx(m,{className:"gutter-row",xs:{span:24},sm:{span:12},md:{span:12},lg:{span:6},children:e.jsxs("div",{className:"whiteBox shadow",style:{color:"#595959",fontSize:13,minHeight:"106px",height:"100%"},children:[e.jsx("div",{className:"pad15 strong",style:{textAlign:"center",justifyContent:"center"},children:e.jsx("h3",{style:{color:"#22075e",fontSize:"large",margin:"5px 0",textTransform:"capitalize"},children:t})}),e.jsx(k,{style:{padding:0,margin:0}}),e.jsx("div",{className:"pad15",children:e.jsxs(x,{gutter:[0,0],justify:"space-between",wrap:!1,children:[e.jsx(m,{className:"gutter-row",flex:"85px",style:{textAlign:"left"},children:e.jsx("div",{className:"left",style:{whiteSpace:"nowrap"},children:a})}),e.jsx(k,{style:{height:"100%",padding:"10px 0",justifyContent:"center",alignItems:"center"},type:"vertical"}),e.jsx(m,{className:"gutter-row",flex:"auto",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:g?e.jsx(O,{}):e.jsx(V,{title:r,style:{direction:"ltr"},children:e.jsx(B,{color:n,style:{margin:"0 auto",justifyContent:"center",maxWidth:"110px",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",direction:"ltr"},children:o?s(r):r})})})]})})]})})}const se={draft:"#595959",sent:"#1890ff",pending:"#1890ff",unpaid:"#ffa940",overdue:"#ff4d4f",partially:"#13c2c2",paid:"#95de64",declined:"#ff4d4f",accepted:"#95de64",cyan:"#13c2c2",purple:"#722ed1",expired:"#614700"},re={draft:"Dự thảo",sent:"Đã gửi",success:"Thành công",pending:"Đang chờ",cancelled:"Đã hủy",failed:"Thất bại",unpaid:"Chưa thanh toán",overdue:"Quá hạn",partially:"Một phần",paid:"Đã thanh toán",declined:"Đã từ chối",accepted:"Đã chấp nhận",cyan:"Màu cyan",purple:"Màu tím",expired:"Hết hạn"},A=[{tag:"success",value:0},{tag:"pending",value:0},{tag:"cancelled",value:0},{tag:"accepted",value:0},{tag:"declined",value:0},{tag:"expired",value:0}],ie=[{tag:"success",value:0},{tag:"pending",value:0},{tag:"cancelled",value:0},{tag:"failed",value:0}],oe=({tag:t,value:n})=>{const r=b(),a=re[t]||t;return e.jsxs("div",{style:{color:"#595959",marginBottom:5},children:[e.jsx("div",{className:"left alignLeft capitalize",children:r(a)}),e.jsxs("div",{className:"right alignRight",children:[n," %"]}),e.jsx(M,{percent:n,showInfo:!1,strokeColor:{"0%":"#333","100%":"#333"}})]})};function le({title:t="Preview",statistics:n=A,isLoading:r=!1,entity:a="roomBooking"}){const o=p.useMemo(()=>a==="roomBooking"?ie.map(s=>(Array.isArray(n)?n.find(d=>d.tag===s.tag):null)||s):A.map(s=>(Array.isArray(n)?n.find(d=>d.tag===s.tag):null)||s),[n,a]),g=(s,h)=>{const d=Object.values(se),v=d.indexOf(s.props.color),f=d.indexOf(h.props.color);return v-f};return e.jsx(m,{className:"gutter-row",xs:{span:24},sm:{span:24},md:{span:24},lg:{span:24},children:e.jsxs("div",{className:"pad20",children:[e.jsx("h3",{style:{color:"#22075e",fontSize:"large",marginBottom:40,marginTop:0},children:t}),r?e.jsx("div",{style:{textAlign:"center"},children:e.jsx(O,{})}):o==null?void 0:o.map((s,h)=>e.jsx(oe,{tag:s.tag,value:s==null?void 0:s.value},h)).sort(g)]})})}function ce({isLoading:t=!1,activeCustomer:n=0,newCustomer:r=0}){const a=b();return e.jsx(x,{className:"gutter-row",children:e.jsx("div",{className:"whiteBox shadow",style:{height:458},children:e.jsxs("div",{className:"pad20",style:{textAlign:"center",justifyContent:"center"},children:[e.jsx("h3",{style:{color:"#333",marginBottom:40,marginTop:15,fontSize:"large"},children:a("Người dùng")}),t?e.jsx(O,{}):e.jsxs("div",{style:{display:"grid",justifyContent:"center"},children:[e.jsx(M,{type:"dashboard",percent:r,size:148}),e.jsx("p",{children:a("Người dùng mới tháng này")}),e.jsx(k,{}),e.jsx(Q,{title:a("Tổng người dùng"),value:n,precision:2,valueStyle:n>0?{color:"#333"}:n<0?{color:"#333"}:{color:"#000000"},prefix:n>0?e.jsx(Z,{}):n<0?e.jsx(J,{}):null})]})]})})})}function de(){const t=b(),{formatCurrency:n}=I(),r=async({entity:i})=>await N.summary({entity:i}),{result:a,isLoading:o,onFetch:g}=U(),{result:s,isLoading:h}=z(()=>N.summary({entity:"user/user-statistic"}));p.useEffect(()=>{g(r({entity:"statistic/statistic-room"}))},[]);const d=[{title:t("Mã"),dataIndex:"bookingReference",render:i=>"#"+i},{title:t("Tên khách"),dataIndex:"fullName"},{title:t("Phòng"),dataIndex:"roomNumber"},{title:t("Thời gian lưu trú"),dataIndex:"checkInDate",onCell:()=>({style:{whiteSpace:"nowrap"}}),render:(i,c)=>{const u=C(c.checkInDate).format("DD/MM/YY"),y=C(c.checkOutDate).format("DD/MM/YY");return`${u} - ${y}`}},{title:t("Số người"),dataIndex:"numberOfPeople"},{title:t("Tổng tiền"),dataIndex:"price",onCell:()=>({style:{textAlign:"right",whiteSpace:"nowrap",direction:"ltr"}}),render:(i,c)=>e.jsx(e.Fragment,{children:n(c.price)})},{title:t("Trạng thái"),dataIndex:"bookingStatus",key:"bookingStatus",render:i=>{const c={Cancelled:"yellow",Pending:"orange",Success:"green",Failed:"red"},u={Cancelled:"Đã hủy",Pending:"Đang chờ",Success:"Đã đặt",Failed:"Thất bại"};return e.jsx(B,{color:c[i]||"default",children:u[i]||"Không xác định"})}},{title:t("Ngày đặt"),dataIndex:"createdAt",onCell:()=>({style:{whiteSpace:"nowrap"}}),render:(i,c)=>C(c.createdAt).format("DD/MM/YYYY")}],f=[{result:a,isLoading:o,entity:"roomBooking",title:t("Tỷ lệ Đặt phòng")}].map((i,c)=>{const{result:u,entity:y,isLoading:l,title:j}=i;return e.jsx(le,{title:j,isLoading:l,entity:y,statistics:!l&&Object.entries((u==null?void 0:u.roombookingStatusStatistic)||{}).map(([w,F])=>({tag:w,color:"blue",value:F}))},c)});return e.jsxs(e.Fragment,{children:[e.jsxs(x,{gutter:[32,32],children:[e.jsx(S,{title:t("Lượt đặt phòng"),prefix:t("Tháng này"),isLoading:o,data:a==null?void 0:a.totalBooking,isCurrency:!1}),e.jsx(S,{title:t("Đã thanh toán"),prefix:t("Tháng này"),isLoading:o,data:a==null?void 0:a.totalPaid}),e.jsx(S,{title:t("Chưa thanh toán"),prefix:t("Tháng này"),isLoading:o,data:a==null?void 0:a.totalUnpaid}),e.jsx(S,{title:t("Đã hoàn tiền"),prefix:t("Tháng này"),isLoading:o,data:a==null?void 0:a.totalRefunded})]}),e.jsx("div",{className:"space30"}),e.jsxs(x,{gutter:[32,32],children:[e.jsx(m,{className:"gutter-row w-full",sm:{span:24},md:{span:24},lg:{span:18},children:e.jsx("div",{className:"whiteBox shadow",style:{height:458},children:e.jsx(x,{className:"pad20",gutter:[0,0],children:f})})}),e.jsx(m,{className:"gutter-row w-full",sm:{span:24},md:{span:24},lg:{span:6},children:e.jsx(ce,{isLoading:h,activeCustomer:s==null?void 0:s.totalCustomers,newCustomer:s==null?void 0:s.totalNewCustomers})})]}),e.jsx("div",{className:"space30"}),e.jsx(x,{gutter:[32,32],children:e.jsx(m,{className:"gutter-row w-full",sm:{span:24},lg:{span:24},children:e.jsxs("div",{className:"whiteBox shadow pad20",style:{height:"100%"},children:[e.jsx("h3",{style:{color:"#22075e",marginBottom:5,padding:"0 20px 20px"},children:t("Đặt phòng gần đây")}),e.jsx(ae,{entity:"roombooking",dataTableColumns:d})]})})})]})}function ke(){return e.jsx(de,{})}export{ke as default};
