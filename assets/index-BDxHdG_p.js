import{aq as $,ah as e,ar as v,as as L,a as b}from"./index-C5Hw-WH9.js";import{P as R}from"./index-DjRnzsJr.js";import{I as _,J as F,a9 as N,B as k,F as X,M as z}from"./IdurarOs-DZCQDfqB.js";import{e as r}from"./actions-DP6GLw71.js";import{c as H,d as J}from"./selectors-Cw4-DQYI.js";import{a as T}from"./index-BAO1k-cZ.js";import{s as I}from"./index-KrFx5yLV.js";import{D as W,E as q}from"./ErpApp-luviQjv1.js";import{F as K}from"./Table-87euyClI.js";import{D as U}from"./DeleteOutlined-Cx6e6mO4.js";import{A as Y}from"./ArrowLeftOutlined-CGiPZklH.js";import{R as G,v as Q}from"./helpers-Dwjkb3vG.js";import{P as V}from"./PlusOutlined-Dpzt2bhY.js";import{M as Z}from"./index-BaSkYAwT.js";function ee({config:o}){const c=v(),{ADD_NEW_ENTITY:n,entity:s}=o,l=()=>{c(`/${s.toLowerCase()}/create`)};return e.jsx(k,{onClick:l,type:"primary",icon:e.jsx(V,{}),children:n})}function te({config:o,extra:c=[]}){const n=X();let{entity:s,dataTableColumns:l,disableAdd:m=!1,searchConfig:i}=o;const{DATATABLE_TITLE:f}=o,{result:y,isLoading:j}=$(H),{pagination:C,items:D}=y,{erpContextAction:x}=T(),{modal:E}=x,w=[{label:n("Xem"),key:"read",icon:e.jsx(_,{})},{label:n("Chỉnh sửa"),key:"edit",icon:e.jsx(F,{})},...c,{type:"divider"},{label:n("Xóa"),key:"delete",icon:e.jsx(U,{})}],u=v(),g=t=>{p(r.currentItem({data:t})),u(`/${s}/read/${t.id}`)},d=t=>{const a={...t};p(r.currentAction({actionType:"update",data:a})),u(`/${s}/update/${t.id}`)},A=t=>{window.open(`${z}${s}/${s}-${t.id}.pdf`,"_blank")},S=t=>{p(r.currentAction({actionType:"delete",data:t})),E.open()},B=t=>{p(r.currentItem({data:t})),u(`/invoice/pay/${t.id}`)};l=[...l,{title:"",key:"action",fixed:"right",render:(t,a)=>e.jsx(W,{menu:{items:w,onClick:({key:h})=>{switch(h){case"read":g(a);break;case"edit":d(a);break;case"download":A(a);break;case"delete":S(a);break;case"recordPayment":B(a);break}}},trigger:["click"],children:e.jsx(q,{style:{cursor:"pointer",fontSize:"24px"},onClick:h=>h.preventDefault()})})}];const p=L(),O=t=>{const a={page:t.current||1,items:t.pageSize||10};p(r.list({entity:s,options:a}))},M=()=>{p(r.list({entity:s}))};b.useEffect(()=>{const t=new AbortController;return M(),()=>{t.abort()}},[]);const P=t=>{const a=t.target.value,h={search:a,filter:i==null?void 0:i.entity};p(r.list({entity:s,options:h})),console.log("search:"+a+JSON.stringify(h))};return e.jsxs(e.Fragment,{children:[e.jsx(R,{title:f,ghost:!0,onBack:()=>window.history.back(),backIcon:e.jsx(Y,{}),extra:[e.jsx(N,{onChange:P,placeholder:n("Tìm kiếm"),allowClear:!0},"searchFilterDataTable}"),e.jsx(k,{onClick:O,icon:e.jsx(G,{}),children:n("Làm mới")},`${I.generate()}`),!m&&e.jsx(ee,{config:o},`${I.generate()}`)],style:{padding:"20px 0px"}}),e.jsx(K,{columns:l,rowKey:t=>t.id,dataSource:D,pagination:C,loading:j,onChange:O,scroll:{x:!0}})]})}function se({config:o}){let{entity:c,deleteModalLabels:n,deleteMessage:s="Bạn có chắc chắn xóa : ",modalTitle:l="Xóa"}=o;const m=L(),{current:i,isLoading:f,isSuccess:y}=$(J),{state:j,erpContextAction:C}=T(),{deleteModal:D}=j,{modal:x}=C,[E,w]=b.useState("");b.useEffect(()=>{if(y){x.close();const d={page:1,items:10};m(r.list({entity:c,options:d}))}if(i){let d=n.map(A=>Q(i,A)).join(" ");w(d)}},[y,i]);const u=()=>{const d=i.id;m(r.delete({entity:c,id:d})),x.close()},g=()=>{f||x.close()};return e.jsx(Z,{title:l,open:D.isOpen,onOk:u,onCancel:g,confirmLoading:f,footer:[e.jsx(k,{onClick:g,children:"Hủy"},"back"),e.jsx(k,{type:"primary",onClick:u,children:"Đồng ý"},"submit")],children:e.jsxs("p",{children:[s,E]})})}function ye({config:o,extra:c}){const n=L(),{state:s}=T(),{deleteModal:l}=s,m=()=>{n(r.resetState())};return b.useLayoutEffect(()=>{const i=new AbortController;return m(),()=>{i.abort()}},[]),e.jsxs(e.Fragment,{children:[e.jsx(te,{config:o,extra:c}),e.jsx(se,{config:o,isOpen:l.isOpen})]})}export{ye as E};
